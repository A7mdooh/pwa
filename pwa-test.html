<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± ØµØ­Ø© PWA</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #00796B, #4DB6AC); 
            min-height: 100vh; 
            padding: 20px; 
            color: #333;
        }
        .container { 
            max-width: 800px; 
            margin: 0 auto; 
            background: white; 
            border-radius: 12px; 
            box-shadow: 0 8px 32px rgba(0,0,0,0.1); 
            overflow: hidden;
        }
        .header { 
            background: #00796B; 
            color: white; 
            padding: 20px; 
            text-align: center; 
        }
        .content { padding: 20px; }
        .test-item { 
            margin: 15px 0; 
            padding: 15px; 
            border-radius: 8px; 
            border-left: 4px solid #ddd; 
        }
        .test-item.pass { 
            background: #e8f5e8; 
            border-left-color: #4CAF50; 
        }
        .test-item.fail { 
            background: #ffebee; 
            border-left-color: #f44336; 
        }
        .test-item.warn { 
            background: #fff3e0; 
            border-left-color: #ff9800; 
        }
        .status { 
            font-weight: bold; 
            margin-bottom: 8px; 
        }
        .status.pass { color: #4CAF50; }
        .status.fail { color: #f44336; }
        .status.warn { color: #ff9800; }
        button { 
            background: #00796B; 
            color: white; 
            border: none; 
            padding: 12px 24px; 
            border-radius: 6px; 
            cursor: pointer; 
            margin: 10px 5px; 
            font-size: 14px;
        }
        button:hover { background: #004D40; }
        .info { 
            background: #f5f5f5; 
            padding: 15px; 
            border-radius: 8px; 
            margin: 15px 0; 
        }
        .log { 
            background: #1e1e1e; 
            color: #00ff00; 
            padding: 15px; 
            border-radius: 8px; 
            font-family: 'Courier New', monospace; 
            font-size: 12px; 
            max-height: 200px; 
            overflow-y: auto; 
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ” Ø§Ø®ØªØ¨Ø§Ø± ØµØ­Ø© PWA</h1>
            <p>ÙØ­Øµ Ø´Ø§Ù…Ù„ Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Progressive Web App</p>
        </div>
        
        <div class="content">
            <button onclick="runAllTests()">ğŸ§ª ØªØ´ØºÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</button>
            <button onclick="clearResults()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
            <button onclick="exportResults()">ğŸ“¥ ØªØµØ¯ÙŠØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
            
            <div class="info">
                <h3>ğŸ“‹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h3>
                <p id="systemInfo">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
            </div>
            
            <div id="testResults"></div>
            
            <div class="log" id="testLog" style="display: none;">
                <h4>ğŸ“ Ø³Ø¬Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª:</h4>
                <div id="logContent"></div>
            </div>
        </div>
    </div>

    <script>
        let testResults = [];
        let logEntries = [];

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            logEntries.push(`[${timestamp}] ${type.toUpperCase()}: ${message}`);
            updateLogDisplay();
        }

        function updateLogDisplay() {
            const logContent = document.getElementById('logContent');
            logContent.innerHTML = logEntries.join('<br>');
            document.getElementById('testLog').style.display = 'block';
        }

        // Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
        function displaySystemInfo() {
            const info = {
                userAgent: navigator.userAgent,
                language: navigator.language,
                platform: navigator.platform,
                online: navigator.onLine,
                cookieEnabled: navigator.cookieEnabled,
                serviceWorkerSupport: 'serviceWorker' in navigator,
                notificationSupport: 'Notification' in window,
                pushSupport: 'PushManager' in window,
                cacheSupport: 'caches' in window,
                httpsProtocol: location.protocol === 'https:',
                currentUrl: location.href
            };

            const infoHtml = Object.entries(info).map(([key, value]) => {
                const status = typeof value === 'boolean' ? (value ? 'âœ…' : 'âŒ') : '';
                return `<strong>${key}:</strong> ${status} ${value}`;
            }).join('<br>');

            document.getElementById('systemInfo').innerHTML = infoHtml;
        }

        // Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª PWA
        const tests = [
            {
                name: 'Ø¯Ø¹Ù… Service Worker',
                test: () => 'serviceWorker' in navigator,
                description: 'Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¯Ø¹Ù… Ø§Ù„Ù…ØªØµÙØ­ Ù„Ù€ Service Workers'
            },
            {
                name: 'Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„ HTTPS',
                test: () => location.protocol === 'https:' || location.hostname === 'localhost',
                description: 'PWA ÙŠØªØ·Ù„Ø¨ HTTPS Ø£Ùˆ localhost Ù„Ù„ØªØ·ÙˆÙŠØ±'
            },
            {
                name: 'Web App Manifest',
                test: async () => {
                    try {
                        const response = await fetch('./manifest.json');
                        return response.ok;
                    } catch (e) {
                        return false;
                    }
                },
                description: 'Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ù„Ù Web App Manifest'
            },
            {
                name: 'ØªØ³Ø¬ÙŠÙ„ Service Worker',
                test: async () => {
                    try {
                        const registration = await navigator.serviceWorker.getRegistration();
                        return !!registration;
                    } catch (e) {
                        return false;
                    }
                },
                description: 'Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Service Worker Ø¨Ù†Ø¬Ø§Ø­'
            },
            {
                name: 'Ø¯Ø¹Ù… Cache API',
                test: () => 'caches' in window,
                description: 'Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¯Ø¹Ù… Cache API Ù„Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø¤Ù‚Øª'
            },
            {
                name: 'Ø¯Ø¹Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª',
                test: () => 'Notification' in window,
                description: 'Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¯Ø¹Ù… Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…ØªØµÙØ­'
            },
            {
                name: 'Ø¯Ø¹Ù… Push API',
                test: () => 'PushManager' in window,
                description: 'Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¯Ø¹Ù… Push notifications'
            },
            {
                name: 'Manifest ÙÙŠ HTML',
                test: () => {
                    const manifest = document.querySelector('link[rel="manifest"]');
                    return !!manifest;
                },
                description: 'Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø±Ø¨Ø· Manifest ÙÙŠ HTML'
            },
            {
                name: 'Ø£ÙŠÙ‚ÙˆÙ†Ø© Apple Touch',
                test: () => {
                    const icon = document.querySelector('link[rel="apple-touch-icon"]');
                    return !!icon;
                },
                description: 'Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£ÙŠÙ‚ÙˆÙ†Ø© iOS'
            },
            {
                name: 'Theme Color',
                test: () => {
                    const theme = document.querySelector('meta[name="theme-color"]');
                    return !!theme;
                },
                description: 'Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù„ÙˆÙ† Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹'
            },
            {
                name: 'Viewport Meta',
                test: () => {
                    const viewport = document.querySelector('meta[name="viewport"]');
                    return !!viewport;
                },
                description: 'Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Viewport'
            },
            {
                name: 'ØµÙØ­Ø© Offline',
                test: async () => {
                    try {
                        const response = await fetch('./offline.html');
                        return response.ok;
                    } catch (e) {
                        return false;
                    }
                },
                description: 'Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ ØµÙØ­Ø© Ø£ÙˆÙÙ„Ø§ÙŠÙ†'
            }
        ];

        // ØªØ´ØºÙŠÙ„ Ø§Ø®ØªØ¨Ø§Ø± ÙˆØ§Ø­Ø¯
        async function runTest(test) {
            log(`Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø±: ${test.name}`);
            try {
                const result = await test.test();
                const status = result ? 'pass' : 'fail';
                log(`${test.name}: ${result ? 'Ù†Ø¬Ø­' : 'ÙØ´Ù„'}`, status);
                return { ...test, result, status };
            } catch (error) {
                log(`Ø®Ø·Ø£ ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø± ${test.name}: ${error.message}`, 'error');
                return { ...test, result: false, status: 'fail', error: error.message };
            }
        }

        // ØªØ´ØºÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
        async function runAllTests() {
            log('Ø¨Ø¯Ø¡ ØªØ´ØºÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª');
            testResults = [];
            
            for (const test of tests) {
                const result = await runTest(test);
                testResults.push(result);
                displayTestResult(result);
            }
            
            displaySummary();
            log('Ø§Ù†ØªÙ‡Ø§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª');
        }

        // Ø¹Ø±Ø¶ Ù†ØªÙŠØ¬Ø© Ø§Ø®ØªØ¨Ø§Ø±
        function displayTestResult(result) {
            const resultsContainer = document.getElementById('testResults');
            
            const testItem = document.createElement('div');
            testItem.className = `test-item ${result.status}`;
            
            const icon = result.status === 'pass' ? 'âœ…' : 'âŒ';
            const statusText = result.status === 'pass' ? 'Ù†Ø¬Ø­' : 'ÙØ´Ù„';
            
            testItem.innerHTML = `
                <div class="status ${result.status}">${icon} ${result.name} - ${statusText}</div>
                <div>${result.description}</div>
                ${result.error ? `<div style="color: #f44336; font-size: 12px; margin-top: 5px;">Ø®Ø·Ø£: ${result.error}</div>` : ''}
            `;
            
            resultsContainer.appendChild(testItem);
        }

        // Ø¹Ø±Ø¶ Ù…Ù„Ø®Øµ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        function displaySummary() {
            const passed = testResults.filter(r => r.status === 'pass').length;
            const total = testResults.length;
            const percentage = Math.round((passed / total) * 100);
            
            const summaryItem = document.createElement('div');
            summaryItem.className = 'test-item';
            summaryItem.style.background = '#e3f2fd';
            summaryItem.style.borderLeftColor = '#2196F3';
            
            summaryItem.innerHTML = `
                <div class="status" style="color: #2196F3;">ğŸ“Š Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</div>
                <div>Ù†Ø¬Ø­ ${passed} Ù…Ù† ${total} Ø§Ø®ØªØ¨Ø§Ø± (${percentage}%)</div>
                <div style="margin-top: 10px;">
                    ${percentage >= 80 ? 'ğŸ‰ Ù…Ù…ØªØ§Ø²! Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¬Ø§Ù‡Ø² ÙƒÙ€ PWA' : 
                      percentage >= 60 ? 'âš ï¸ Ø¬ÙŠØ¯ØŒ Ù„ÙƒÙ† ÙŠØ­ØªØ§Ø¬ Ø¨Ø¹Ø¶ Ø§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª' : 
                      'âŒ ÙŠØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø¥ØµÙ„Ø§Ø­Ø§Øª Ù…Ù‡Ù…Ø©'}
                </div>
            `;
            
            document.getElementById('testResults').appendChild(summaryItem);
        }

        // Ù…Ø³Ø­ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        function clearResults() {
            document.getElementById('testResults').innerHTML = '';
            document.getElementById('testLog').style.display = 'none';
            testResults = [];
            logEntries = [];
            log('ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†ØªØ§Ø¦Ø¬');
        }

        // ØªØµØ¯ÙŠØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        function exportResults() {
            const report = {
                timestamp: new Date().toISOString(),
                url: location.href,
                userAgent: navigator.userAgent,
                results: testResults,
                logs: logEntries
            };
            
            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `pwa-test-report-${new Date().toISOString().slice(0, 19)}.json`;
            a.click();
            
            URL.revokeObjectURL(url);
            log('ØªÙ… ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª');
        }

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', () => {
            displaySystemInfo();
            log('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø£Ø¯ÙˆØ§Øª Ø§Ø®ØªØ¨Ø§Ø± PWA');
        });

        // Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ø¶Ø§ÙÙŠ Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.ready.then(registration => {
                log('Service Worker Ø¬Ø§Ù‡Ø² ÙˆÙ†Ø´Ø·');
            }).catch(error => {
                log(`Ø®Ø·Ø£ ÙÙŠ Service Worker: ${error.message}`, 'error');
            });
        }

        // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„
        window.addEventListener('online', () => log('ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª'));
        window.addEventListener('offline', () => log('ØªÙ… Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª'));
    </script>
</body>
</html>
